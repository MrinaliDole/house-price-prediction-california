# -*- coding: utf-8 -*-
"""app_simple.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1N5yIv3pZ5D5fEINpUsHZzIf_vSkbSJX-
"""

!pip install streamlit
import streamlit as st
import joblib
import numpy as np
import pandas as pd

# Page configuration
st.set_page_config(
    page_title="House Price Predictor - Simple",
    page_icon="üè†",
    layout="centered"
)

st.title("üè† House Price Predictor")
st.markdown("### Quick Price Estimate")
st.markdown("---")

# Load model
@st.cache_resource
def load_model():
    try:
        model = joblib.load('xgboost_model.pkl')
        metadata = joblib.load('model_metadata.pkl')
        return model, metadata
    except Exception as e:
        st.error(f"Error loading model: {e}")
        return None, None

model, metadata = load_model()

if model is not None and metadata is not None:
    st.success("‚úÖ Model loaded successfully!")

    # Simple 4-input form
    st.markdown("### Enter Property Details")

    col1, col2 = st.columns(2)

    with col1:
        living_area = st.number_input(
            "Living Area (sq ft)",
            min_value=300,
            max_value=10000,
            value=1500,
            step=50
        )

        beds = st.number_input(
            "Bedrooms",
            min_value=1,
            max_value=10,
            value=3,
            step=1
        )

    with col2:
        baths = st.number_input(
            "Bathrooms",
            min_value=1.0,
            max_value=10.0,
            value=2.0,
            step=0.5
        )

        lot_size = st.number_input(
            "Lot Size (sq ft)",
            min_value=0,
            max_value=100000,
            value=5000,
            step=100
        )

    st.markdown("---")

    if st.button("üîÆ Predict Price", type="primary", use_container_width=True):
        try:
            # Use defaults for missing features
            year_built = 2000  # Default year
            property_age = 2025 - year_built

            # Feature engineering with defaults
            features = {
                'LivingArea': living_area,
                'BedroomsTotal': beds,
                'BathroomsTotalInteger': baths,
                'LotSizeSquareFeet': lot_size,
                'YearBuilt': year_built,
                'Stories': 1,
                'GarageSpaces': 2,
                'PropertyAge': property_age,
                'PropertyAge_squared': property_age ** 2,
                'TotalRooms': beds + baths,
                'Bath_Bed_Ratio': baths / (beds + 0.1),
                'SqFt_Per_Bedroom': living_area / (beds + 0.1),
                'IsLuxury': int((baths >= 4) and (beds >= 4) and (living_area >= 3000)),
                'HasPool': 0,
                'HasGarage': 1,
                'log_LivingArea': np.log1p(living_area),
                'log_LotSizeSquareFeet': np.log1p(lot_size),
                'PoolPrivateYN': 0,
                'BasementYN': 0,
                'FireplaceYN': 0,
                'WaterfrontYN': 0,
                'ViewYN': 0,
                'NewConstructionYN': 0,
                'PostalCode': '92101'  # Default San Diego ZIP
            }

            # Create DataFrame and align with training features
            input_df = pd.DataFrame([features])

            for col in metadata['feature_names']:
                if col not in input_df.columns:
                    input_df[col] = 0

            input_df = input_df[metadata['feature_names']]

            # Predict (log scale) and back-transform
            log_pred = model.predict(input_df)[0]
            predicted_price = np.expm1(log_pred) * metadata['smearing_factor']

            # Display
            st.markdown("### üí∞ Estimated Price")
            st.markdown(f"## ${predicted_price:,.0f}")

            lower = predicted_price * 0.9
            upper = predicted_price * 1.1
            st.markdown(f"**Range:** ${lower:,.0f} - ${upper:,.0f}")

            with st.expander("üìä Input Summary"):
                st.write(f"Living Area: {living_area:,} sq ft")
                st.write(f"Bedrooms: {beds}")
                st.write(f"Bathrooms: {baths}")
                st.write(f"Lot Size: {lot_size:,} sq ft")
                st.caption("*Using default values for other features*")

        except Exception as e:
            st.error(f"Prediction error: {e}")

    st.markdown("---")
    st.info("üí° This simplified version uses default values for features not shown above.")

else:
    st.error("‚ùå Model files not found in repository")